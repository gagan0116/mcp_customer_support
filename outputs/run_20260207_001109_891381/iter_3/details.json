{
  "description": "## Figure Description: Autonomous Customer Support Pipeline Architecture\n\nThis figure presents a detailed architectural diagram of the Autonomous Customer Support Pipeline, illustrating the end-to-end flow from initial customer email to final resolution. The diagram uses a clean, professional style with a soft ice-blue background to enhance readability. Icons are modern and minimalist, and arrows indicate the flow of data and control.\n\n**1. Overall Layout:**\n\nThe diagram follows a left-to-right flow, divided into six distinct phases: Ingestion & Event Triggering, Multi-Modal Perception Grid, Structural Extraction, Agentic Verification Loop, Policy Adjudication, and Resolution & Feedback. Each phase is visually separated by subtle vertical dividers made of very thin, light grey dashed lines.\n\n**2. Components:**\n\n*   **Phase 1: Ingestion & Event Triggering (Leftmost Section)**\n    *   **Gmail Event Processor:** A rounded rectangle labeled \"Gmail Event Processor\" in bold sans-serif font. It has a small, desaturated Gmail icon integrated into the top-left corner. The box is filled with a light sage green.\n    *   **Incoming Email:** An email icon entering the \"Gmail Event Processor\" from the left, labeled \"Customer Email (Return/Refund Request)\" in italicized serif font.\n    *   **Attachments:** Two smaller icons branching off from the \"Incoming Email\" arrow: a PDF icon labeled \"Proof of Purchase (PDF Invoice)\" and an image icon labeled \"Proof of Defect (Image)\", both in italicized serif font.\n    *   **Google Cloud Storage (GCS):** A cloud icon on the right side of the \"Gmail Event Processor\". Arrows originate from the \"Proof of Purchase (PDF Invoice)\" and \"Proof of Defect (Image)\" attachments and point to the cloud icon, labeled \"Google Cloud Storage (GCS)\" in italicized serif font. The cloud icon has a soft grey fill.\n    *   **MCP Processor Event:** An arrow exiting the \"Gmail Event Processor\" towards the right, leading to the next phase. The arrow is labeled \"Structured Event Object (Email Body, Metadata)\" in italicized serif font.\n\n*   **Phase 2: Multi-Modal Perception Grid (Second Section)**\n    *   **MCP Processor:** A central, prominent rounded rectangle labeled \"MCP Processor\" in bold sans-serif font. It is filled with a light cream color.\n    *   **Doc Server Agent (The Reader):** A smaller rounded rectangle above the \"MCP Processor\" labeled \"Doc Server Agent\" in bold sans-serif font. It has a document icon integrated into the top-left corner, and is filled with a warm peach color.\n        *   **process_invoice (pypdf):** A label inside the \"Doc Server Agent\" box indicating the tool used: \"Tool: process_invoice (pypdf)\" in italicized serif font.\n        *   **Input Arrow:** An arrow leading into the \"Doc Server Agent\" from the \"MCP Processor\", labeled \"PDF Invoice\" in italicized serif font.\n        *   **Output Arrow:** An arrow leading out of the \"Doc Server Agent\" back to the \"MCP Processor\", labeled \"Extracted Text (Order Number, Date, Line Items)\" in italicized serif font.\n    *   **Defect Analyzer Agent (The Eye):** A smaller rounded rectangle below the \"MCP Processor\" labeled \"Defect Analyzer Agent\" in bold sans-serif font. It has an eye icon integrated into the top-left corner and is filled with a pale lavender.\n        *   **Gemini 3 Vision:** A label inside the \"Defect Analyzer Agent\" box indicating the tool used: \"Tool: analyze_defect_image (Gemini 3 Vision)\" in italicized serif font.\n        *   **Input Arrow:** An arrow leading into the \"Defect Analyzer Agent\" from the \"MCP Processor\", labeled \"Defect Image\" in italicized serif font.\n        *   **Output Arrow:** An arrow leading out of the \"Defect Analyzer Agent\" back to the \"MCP Processor\", labeled \"Defect Description (e.g., 'Screen cracked...')\" in italicized serif font.\n\n*   **Phase 3: Structural Extraction (Middle Section)**\n    *   **Extraction Agent:** A rounded rectangle labeled \"Extraction Agent\" in bold sans-serif font. It is filled with a soft sky blue.\n    *   **Input Arrows:** Three arrows leading into the \"Extraction Agent\" from the \"MCP Processor\", labeled \"Email Body\", \"Extracted Text\", and \"Defect Description\", all in italicized serif font.\n    *   **Output Arrow:** An arrow exiting the \"Extraction Agent\" towards the right, labeled \"Unverified Order Object (Customer Email, Order ID, Item, Reason)\" in italicized serif font.\n\n*   **Phase 4: The Agentic Verification Loop (Fourth Section)**\n    *   **DB Verification Agent (The Detective):** A large rounded rectangle labeled \"DB Verification Agent\" in bold sans-serif font. It is filled with a light rose color.\n    *   **Postgres Database:** A cylinder icon to the right of the \"DB Verification Agent,\" labeled \"Postgres Database (Source of Truth)\" in italicized serif font. The cylinder has a light grey fill and a slightly darker grey border.\n    *   **Verification Loop:** A curved arrow originating from the \"DB Verification Agent\" going to the \"Postgres Database\" and then back to the \"DB Verification Agent\", indicating an iterative process. The arrow is a thicker dashed line to emphasize the loop.\n    *   **Step 1: Identity Verification:** A labeled box inside the \"DB Verification Agent\" indicating the first step, label in italicized serif font.\n        *   **verify_from_email_matches_customer:** A label indicating the specific tool/function used, label in italicized serif font.\n    *   **Step 2: Hierarchical Order Search:** A labeled box inside the \"DB Verification Agent\" indicating the second step, label in italicized serif font. This box contains four sub-steps represented as bullet points:\n        *   **Attempt 1 (The Sniper):** `find_order_by_order_invoice_id` in italicized serif font.\n        *   **Attempt 2 (The Backup):** `find_order_by_invoice_number` in italicized serif font.\n        *   **Attempt 3 (The Dragnet):** `get_customer_orders_with_items` in italicized serif font.\n        *   **Attempt 4 (The Specialist):** `llm_find_orders` (with a small AI brain icon next to it to denote LLM) in italicized serif font.\n    *   **Output Arrow:** An arrow exiting the \"DB Verification Agent\" towards the right, labeled \"Verified Order Object (Item, Price, Date Confirmed)\" in italicized serif font.\n\n*   **Phase 5: The Policy Adjudicator (Fifth Section)**\n    *   **Adjudicator Agent (The Judge):** A large rounded rectangle labeled \"Adjudicator Agent\" in bold sans-serif font. It is filled with a light apricot color.\n    *   **Input Arrow:** An arrow leading into the \"Adjudicator Agent\" from the \"DB Verification Agent\", labeled \"Verified Order Object\" in italicized serif font.\n    *   **Neo4j Knowledge Graph:** A graph icon to the right of the \"Adjudicator Agent,\" labeled \"Neo4j Knowledge Graph (Policy Rules)\" in italicized serif font. A bidirectional arrow goes from the \"Adjudicator Agent\" to the \"Neo4j Knowledge Graph\". The graph icon has a light grey fill.\n    *   **6-Step Process:** A numbered list (1-6) inside the \"Adjudicator Agent\" box, outlining the six steps of the adjudication process, labels in italicized serif font, with a slightly larger font size:\n        1.  Context Building (Days Since Delivery, Loyalty Tier)\n        2.  Taxonomy Classification (LLM - Product Category) (with a small AI brain icon next to it to denote LLM).\n        3.  Graph Traversal (Policy Rules)\n        4.  Source Retrieval (Policy Text Citations)\n        5.  Reasoning (Thinking Mode)\n        6.  The Verdict (APPROVED/DENIED/MANUAL_REVIEW)\n    *   **Draft Email Response:** A text box within the \"Adjudicator Agent\" labeled \"Draft Empathetic Email Response\" in italicized serif font.\n    *   **Output Arrows:** Two arrows exiting the \"Adjudicator Agent\". One is labeled \"Decision (APPROVED/DENIED/MANUAL REVIEW)\". This arrow splits, with one branch leading to the \"Refund Requests Database\" and another branch leading to the \"Human Agent Review\" flag (only active if the decision is \"MANUAL_REVIEW\"). The second arrow is labeled \"Drafted Email Response\", which leads to the \"Customer\" icon.\n\n*   **Phase 6: Resolution & Feedback (Rightmost Section)**\n    *   **Refund Requests Database:** A database icon labeled \"Refund Requests Database\" in italicized serif font. An arrow leads from the \"Adjudicator Agent\" (Decision) to this database. The database icon has a light grey fill.\n    *   **Customer:** A person icon on the far right, labeled \"Customer\" in italicized serif font. An arrow leads from the \"Adjudicator Agent\" (Drafted Email Response) to the Customer icon.\n    *   **Manual Review Flag:** A small flag icon with an arrow leading to it from the \"Adjudicator Agent\" (Decision), only active if the decision is \"MANUAL_REVIEW\". The flag icon is labeled \"Human Agent Review\" in italicized serif font.\n\n**3. Connections:**\n\n*   Solid dark grey arrows indicate the primary flow of data and control.\n*   Dashed dark grey arrows are used for feedback loops or secondary information flows.\n*   Arrow thickness is consistent throughout the diagram.\n*   Each arrow is clearly labeled with the type of data being transferred in italicized serif font.\n\n**4. Groupings:**\n\n*   Each phase is visually separated by thin, light grey dashed vertical lines.\n*   The Agentic Verification Loop (Phase 4) is enclosed in a dashed dark grey border to emphasize its iterative nature.\n\n**5. Labels and Annotations:**\n\n*   All labels are clear, concise, and use a consistent sans-serif font (e.g., Arial).\n*   Agent names and major components are highlighted in bold sans-serif font.\n*   Tool names (e.g., pypdf, Gemini 3 Vision) are in italicized serif font.\n*   Annotations provide additional context and explanations where needed, in italicized serif font.\n\n**6. Input/Output:**\n\n*   The primary input is the Customer Email in Phase 1.\n*   The primary outputs are the Decision (APPROVED/DENIED/MANUAL_REVIEW), the Drafted Email Response, and the update to the Refund Requests Database.",
  "critique": {
    "critic_suggestions": [
      "In Phase 5, the connection between the Adjudicator Agent and the Neo4j Knowledge Graph should be a bidirectional arrow, as the agent consults the knowledge graph and potentially updates it.",
      "In Phase 5, the 6-step process inside the Adjudicator Agent box should be formatted as a numbered list for better readability.",
      "The arrows connecting the 'Proof of Purchase' and 'Proof of Defect' to the 'Google Cloud Storage (GCS)' should originate from the Gmail Event Processor, not directly from the attachments themselves.",
      "The label 'Decision (APPROVED/DENIED/MANUAL REVIEW)' should be placed closer to the arrow's endpoint, indicating the final decision output from the Adjudicator Agent."
    ],
    "revised_description": "## Figure Description: Autonomous Customer Support Pipeline Architecture\n\nThis figure presents a detailed architectural diagram of the Autonomous Customer Support Pipeline, illustrating the end-to-end flow from initial customer email to final resolution. The diagram uses a clean, professional style with a soft ice-blue background to enhance readability. Icons are modern and minimalist, and arrows indicate the flow of data and control.\n\n**1. Overall Layout:**\n\nThe diagram follows a left-to-right flow, divided into six distinct phases: Ingestion & Event Triggering, Multi-Modal Perception Grid, Structural Extraction, Agentic Verification Loop, Policy Adjudication, and Resolution & Feedback. Each phase is visually separated by subtle vertical dividers made of very thin, light grey dashed lines.\n\n**2. Components:**\n\n*   **Phase 1: Ingestion & Event Triggering (Leftmost Section)**\n    *   **Gmail Event Processor:** A rounded rectangle labeled \"Gmail Event Processor\" in bold sans-serif font. It has a small, desaturated Gmail icon integrated into the top-left corner. The box is filled with a light sage green.\n    *   **Incoming Email:** An email icon entering the \"Gmail Event Processor\" from the left, labeled \"Customer Email (Return/Refund Request)\" in italicized serif font.\n    *   **Attachments:** Two smaller icons branching off from the \"Gmail Event Processor\": a PDF icon labeled \"Proof of Purchase (PDF Invoice)\" and an image icon labeled \"Proof of Defect (Image)\", both in italicized serif font.\n    *   **Google Cloud Storage (GCS):** A cloud icon on the right side of the \"Gmail Event Processor\". Arrows originate from the \"Gmail Event Processor\" attachments and point to the cloud icon, labeled \"Google Cloud Storage (GCS)\" in italicized serif font. The cloud icon has a soft grey fill.\n    *   **MCP Processor Event:** An arrow exiting the \"Gmail Event Processor\" towards the right, leading to the next phase. The arrow is labeled \"Structured Event Object (Email Body, Metadata)\" in italicized serif font.\n\n*   **Phase 2: Multi-Modal Perception Grid (Second Section)**\n    *   **MCP Processor:** A central, prominent rounded rectangle labeled \"MCP Processor\" in bold sans-serif font. It is filled with a light cream color.\n    *   **Doc Server Agent (The Reader):** A smaller rounded rectangle above the \"MCP Processor\" labeled \"Doc Server Agent\" in bold sans-serif font. It has a document icon integrated into the top-left corner, and is filled with a warm peach color.\n        *   **process_invoice (pypdf):** A label inside the \"Doc Server Agent\" box indicating the tool used: \"Tool: process_invoice (pypdf)\" in italicized serif font.\n        *   **Input Arrow:** An arrow leading into the \"Doc Server Agent\" from the \"MCP Processor\", labeled \"PDF Invoice\" in italicized serif font.\n        *   **Output Arrow:** An arrow leading out of the \"Doc Server Agent\" back to the \"MCP Processor\", labeled \"Extracted Text (Order Number, Date, Line Items)\" in italicized serif font.\n    *   **Defect Analyzer Agent (The Eye):** A smaller rounded rectangle below the \"MCP Processor\" labeled \"Defect Analyzer Agent\" in bold sans-serif font. It has an eye icon integrated into the top-left corner and is filled with a pale lavender.\n        *   **Gemini 3 Vision:** A label inside the \"Defect Analyzer Agent\" box indicating the tool used: \"Tool: analyze_defect_image (Gemini 3 Vision)\" in italicized serif font.\n        *   **Input Arrow:** An arrow leading into the \"Defect Analyzer Agent\" from the \"MCP Processor\", labeled \"Defect Image\" in italicized serif font.\n        *   **Output Arrow:** An arrow leading out of the \"Defect Analyzer Agent\" back to the \"MCP Processor\", labeled \"Defect Description (e.g., 'Screen cracked...')\" in italicized serif font.\n\n*   **Phase 3: Structural Extraction (Middle Section)**\n    *   **Extraction Agent:** A rounded rectangle labeled \"Extraction Agent\" in bold sans-serif font. It is filled with a soft sky blue.\n    *   **Input Arrows:** Three arrows leading into the \"Extraction Agent\" from the \"MCP Processor\", labeled \"Email Body\", \"Extracted Text\", and \"Defect Description\", all in italicized serif font.\n    *   **Output Arrow:** An arrow exiting the \"Extraction Agent\" towards the right, labeled \"Unverified Order Object (Customer Email, Order ID, Item, Reason)\" in italicized serif font.\n\n*   **Phase 4: The Agentic Verification Loop (Fourth Section)**\n    *   **DB Verification Agent (The Detective):** A large rounded rectangle labeled \"DB Verification Agent\" in bold sans-serif font. It is filled with a light rose color.\n    *   **Postgres Database:** A cylinder icon to the right of the \"DB Verification Agent,\" labeled \"Postgres Database (Source of Truth)\" in italicized serif font. The cylinder has a light grey fill and a slightly darker grey border.\n    *   **Verification Loop:** A curved arrow originating from the \"DB Verification Agent\" going to the \"Postgres Database\" and then back to the \"DB Verification Agent\", indicating an iterative process. The arrow is a thicker dashed line to emphasize the loop.\n    *   **Step 1: Identity Verification:** A labeled box inside the \"DB Verification Agent\" indicating the first step, label in italicized serif font.\n        *   **verify_from_email_matches_customer:** A label indicating the specific tool/function used, label in italicized serif font.\n    *   **Step 2: Hierarchical Order Search:** A labeled box inside the \"DB Verification Agent\" indicating the second step, label in italicized serif font. This box contains four sub-steps represented as bullet points:\n        *   **Attempt 1 (The Sniper):** `find_order_by_order_invoice_id` in italicized serif font.\n        *   **Attempt 2 (The Backup):** `find_order_by_invoice_number` in italicized serif font.\n        *   **Attempt 3 (The Dragnet):** `get_customer_orders_with_items` in italicized serif font.\n        *   **Attempt 4 (The Specialist):** `llm_find_orders` (with a small AI brain icon next to it to denote LLM) in italicized serif font.\n    *   **Output Arrow:** An arrow exiting the \"DB Verification Agent\" towards the right, labeled \"Verified Order Object (Item, Price, Date Confirmed)\" in italicized serif font.\n\n*   **Phase 5: The Policy Adjudicator (Fifth Section)**\n    *   **Adjudicator Agent (The Judge):** A large rounded rectangle labeled \"Adjudicator Agent\" in bold sans-serif font. It is filled with a light apricot color.\n    *   **Input Arrow:** An arrow leading into the \"Adjudicator Agent\" from the \"DB Verification Agent\", labeled \"Verified Order Object\" in italicized serif font.\n    *   **Neo4j Knowledge Graph:** A graph icon to the right of the \"Adjudicator Agent,\" labeled \"Neo4j Knowledge Graph (Policy Rules)\" in italicized serif font. A bidirectional arrow goes from the \"Adjudicator Agent\" to the \"Neo4j Knowledge Graph\". The graph icon has a light grey fill.\n    *   **6-Step Process:** A numbered list (1-6) inside the \"Adjudicator Agent\" box, outlining the six steps of the adjudication process, labels in italicized serif font, with a slightly larger font size:\n        1.  Context Building (Days Since Delivery, Loyalty Tier)\n        2.  Taxonomy Classification (LLM - Product Category) (with a small AI brain icon next to it to denote LLM).\n        3.  Graph Traversal (Policy Rules)\n        4.  Source Retrieval (Policy Text Citations)\n        5.  Reasoning (Thinking Mode)\n        6.  The Verdict (APPROVED/DENIED/MANUAL_REVIEW)\n    *   **Draft Email Response:** A text box within the \"Adjudicator Agent\" labeled \"Draft Empathetic Email Response\" in italicized serif font.\n    *   **Output Arrows:** Two arrows exiting the \"Adjudicator Agent\". One is labeled \"Decision (APPROVED/DENIED/MANUAL REVIEW)\" and is placed closer to the arrow's endpoint. This arrow splits, with one branch leading to the \"Refund Requests Database\" and another branch leading to the \"Human Agent Review\" flag (only active if the decision is \"MANUAL_REVIEW\"). The second arrow is labeled \"Drafted Email Response\", which leads to the \"Customer\" icon.\n\n*   **Phase 6: Resolution & Feedback (Rightmost Section)**\n    *   **Refund Requests Database:** A database icon labeled \"Refund Requests Database\" in italicized serif font. An arrow leads from the \"Adjudicator Agent\" (Decision) to this database. The database icon has a light grey fill.\n    *   **Customer:** A person icon on the far right, labeled \"Customer\" in italicized serif font. An arrow leads from the \"Adjudicator Agent\" (Drafted Email Response) to the Customer icon.\n    *   **Manual Review Flag:** A small flag icon with an arrow leading to it from the \"Adjudicator Agent\" (Decision), only active if the decision is \"MANUAL_REVIEW\". The flag icon is labeled \"Human Agent Review\" in italicized serif font.\n\n**3. Connections:**\n\n*   Solid dark grey arrows indicate the primary flow of data and control.\n*   Dashed dark grey arrows are used for feedback loops or secondary information flows.\n*   Arrow thickness is consistent throughout the diagram.\n*   Each arrow is clearly labeled with the type of data being transferred in italicized serif font.\n\n**4. Groupings:**\n\n*   Each phase is visually separated by thin, light grey dashed vertical lines.\n*   The Agentic Verification Loop (Phase 4) is enclosed in a dashed dark grey border to emphasize its iterative nature.\n\n**5. Labels and Annotations:**\n\n*   All labels are clear, concise, and use a consistent sans-serif font (e.g., Arial).\n*   Agent names and major components are highlighted in bold sans-serif font.\n*   Tool names (e.g., pypdf, Gemini 3 Vision) are in italicized serif font.\n*   Annotations provide additional context and explanations where needed, in italicized serif font.\n\n**6. Input/Output:**\n\n*   The primary input is the Customer Email in Phase 1.\n*   The primary outputs are the Decision (APPROVED/DENIED/MANUAL_REVIEW), the Drafted Email Response, and the update to the Refund Requests Database."
  }
}